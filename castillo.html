<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castillo de Gonzalo - Aventura</title>
    <link rel="stylesheet" href="styles/style.css">
    <link rel="icon" type="image/x-icon" href="images/escudo-borrado.ico" />
</head>
<body data-narrativa="Las imponentes murallas del Castillo de San Mart√≠n se alzan ante ti. Un guardia veterano custodia la entrada y te mira con sospecha. 'No muchos vienen preguntando por el viejo Gonzalo...', gru√±e.">

    <div class="escena" style="background-image: url('images/fondo-castillo.jpg');">
        
        <button class="music-btn" onclick="toggleMusic()">üéµ Sonido</button>

        <div class="interfaz-inferior">
            <div id="texto-narrativo"></div>
            
            <div class="opciones-narrativas" id="opciones-inicio">
                <button class="btn-opcion" onclick="mostrarReto('reto-visual', 'saludar_pueblo')">ü§ù Explicar que buscas la verdad con respeto</button>
                <button class="btn-opcion" onclick="mostrarReto('reto-quiz', 'investigar_solo')">üí∞ Ofrecerle una moneda para que te deje pasar</button>
            </div>

            <div class="opciones-narrativas" id="reto-visual" style="display:none;">
                <p style="width:100%; font-style:italic; font-size:0.9rem; color:#cd853f;">El guardia te pone a prueba: 'Si eres quien dices ser, sabr√°s qu√© destaca en nuestra muralla sur...'</p>
                <button class="btn-opcion" onclick="validarReto(true, '¬°Exacto! Gonzalo siempre dec√≠a que esas piedras hablaban. Pasa, forastero.')">La gran muralla de siller√≠a</button>
                <button class="btn-opcion" onclick="validarReto(false, 'Mientes. No has mirado con atenci√≥n. Vete.')">Un foso lleno de agua</button>
            </div>

            <div class="opciones-narrativas" id="reto-quiz" style="display:none;">
                <p style="width:100%; font-style:italic; font-size:0.9rem; color:#cd853f;">El guardia r√≠e: 'Guarda tu oro. Si quieres entrar, dime: ¬øen qu√© siglo se levant√≥ esta torre?'</p>
                <button class="btn-opcion" onclick="validarReto(true, 'Sabes de historia... entra, pero no causes problemas.')">Siglo XV</button>
                <button class="btn-opcion" onclick="validarReto(false, 'Ni con oro entrar√≠a alguien tan ignorante. Largo.')">Siglo XVIII</button>
            </div>

            <button id="btn-siguiente" style="display:none;" onclick="window.location.href='explorar.html'">
                üó∫Ô∏è Continuar la cr√≥nica hacia el mapa...
            </button>
        </div>
    </div>

    <audio id="background-music" src="sounds/musica-medieval.mp3" loop></audio>
    <audio id="success-sound" src="sounds/success.mp3"></audio>
    <audio id="error-sound" src="sounds/error.mp3"></audio>

    <script src="scripts/script.js"></script>

    <script>
        // Funciones espec√≠ficas para la l√≥gica de esta p√°gina
        function mostrarReto(idReto, tipoDecision) {
            // Guardamos la decisi√≥n en el sistema de "Karma"
            if(window.tomarDecision) tomarDecision(tipoDecision);
            
            document.getElementById('opciones-inicio').style.display = 'none';
            document.getElementById(idReto).style.display = 'flex';
            
            if(idReto === 'reto-visual') {
                narrar("El guardia cruza los brazos y te examina de arriba a abajo...");
            } else {
                narrar("El guardia mira la moneda, luego a ti, y niega con la cabeza...");
            }
        }

        function validarReto(esCorrecto, mensaje) {
            document.getElementById('reto-visual').style.display = 'none';
            document.getElementById('reto-quiz').style.display = 'none';
            
            if(esCorrecto) {
                const sound = document.getElementById("success-sound");
                if(sound) sound.play();
                narrar(mensaje);
                setTimeout(() => {
                    document.getElementById('btn-siguiente').style.display = 'block';
                    // Guardamos que el castillo ha sido completado
                    localStorage.setItem('castillo-completed', 'true');
                }, 2000);
            } else {
                const sound = document.getElementById("error-sound");
                if(sound) sound.play();
                narrar(mensaje + " (Has fallado, recarga la p√°gina para intentar otra t√°ctica).");
            }
        }
    </script>
</body>
</html>
